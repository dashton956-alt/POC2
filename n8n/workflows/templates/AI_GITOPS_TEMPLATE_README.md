# 🚀 AI GitOps Network Automation Template

## Overview
This n8n workflow template implements a complete AI-powered GitOps pipeline for network automation, based on enterprise-grade architecture with multi-layer approvals, compliance tracking, and automated rollback capabilities.

## Features

### 🧠 AI-Powered Intent Processing
- **Natural Language Input**: "Create VLAN 100 for Sales team in NYC"
- **Structured Form Input**: Web forms with validation
- **Scheduled Automation**: Maintenance windows and updates
- **OpenAI/Claude Integration**: Intent parsing and playbook generation

### 🔗 NetBox Integration
- **Dynamic Device Discovery**: Automatic inventory from NetBox
- **Site-Specific Configuration**: Location-aware deployments
- **Conflict Detection**: Validates against existing infrastructure
- **Real-time Data**: Always uses current network state

### 📋 GitOps Workflow
- **Infrastructure as Code**: All changes version controlled
- **Branch-based Development**: Feature branches for each change
- **Automated Testing**: Syntax validation and dry runs
- **Progressive Deployment**: Staging → Production pipeline

### ✅ Enterprise Approvals
- **Code Review**: Technical validation in GitLab/GitHub
- **Change Management**: ServiceNow integration
- **Security Scanning**: Automated compliance checks
- **Multi-stakeholder**: Network, Security, and CAB approvals

### 🔄 CI/CD Pipeline
- **Ansible Playbooks**: Generated by AI with best practices
- **Inventory Management**: Dynamic from NetBox data
- **Validation Tests**: Connectivity and performance checks
- **Rollback Plans**: Automatic recovery procedures

## Template Structure

```
📁 AI GitOps Workflow
├── 🔗 Webhook Trigger (Natural language/Forms)
├── 🎯 AI Intent Parser (OpenAI/Claude)
├── 🔍 NetBox Data Enrichment
│   ├── Site/Location Query
│   ├── Device Discovery  
│   └── Existing Config Check
├── 🤖 AI Playbook Generator
│   ├── Ansible YAML Generation
│   ├── Inventory Creation
│   ├── Variables Configuration
│   ├── Test Suite Generation
│   └── Rollback Plan Creation
├── 📝 GitOps Repository
│   ├── Branch Creation
│   ├── File Commits (Playbooks/Inventory/Tests)
│   └── Merge Request Creation
├── 📋 Approval Workflows
│   ├── ServiceNow Change Request
│   ├── Code Review Assignment
│   └── Security Scan Trigger
└── 📢 Notifications
    ├── Slack Alerts
    ├── Email Notifications
    └── Status Dashboard Updates
```

## Multi-Tenant Configuration

### Environment Variables per Customer
```bash
# Customer A
CUSTOMER_ID="customer-a"
NETBOX_URL="https://netbox.customer-a.com"
GITLAB_PROJECT_ID="12345"

# Customer B  
CUSTOMER_ID="customer-b"
NETBOX_URL="https://netbox.customer-b.com"
GITLAB_PROJECT_ID="67890"
```

### Dynamic Routing
The template automatically adapts based on `CUSTOMER_ID`:
- NetBox API endpoints
- Git repository paths
- Webhook URLs
- Notification channels
- Approval workflows

## Deployment Options

### 1. **Shared n8n Instance** (Recommended)
- Single workflow serves multiple customers
- Environment variables differentiate customers
- Resource efficient and centrally managed
- Easy updates and maintenance

### 2. **Container-per-Customer**
- Completely isolated environments
- Full data separation
- Higher resource usage
- Independent scaling

### 3. **Kubernetes Multi-Tenancy**
- Namespace-level isolation
- Auto-scaling capabilities
- Enterprise governance
- Cloud-native deployment

## Sample API Calls

### Natural Language Request
```bash
curl -X POST https://n8n.your-domain.com/webhook/ai-gitops-automation \
  -H "Content-Type: application/json" \
  -H "X-Customer-ID: acme-corp" \
  -d '{
    "user_request": "Create VLAN 200 for Marketing team in London office with subnet 10.200.0.0/24",
    "requester": "john.doe@acme-corp.com",
    "urgency": "medium"
  }'
```

### Structured Form Data
```bash
curl -X POST https://n8n.your-domain.com/webhook/ai-gitops-automation \
  -H "Content-Type: application/json" \
  -H "X-Customer-ID: acme-corp" \
  -d '{
    "intent_type": "structured",
    "action_type": "create",
    "resource_type": "vlan",
    "parameters": {
      "vlan_id": 200,
      "vlan_name": "Marketing",
      "location": "London",
      "subnet": "10.200.0.0/24",
      "description": "Marketing team VLAN for London office"
    },
    "urgency": "medium",
    "requester": "john.doe@acme-corp.com"
  }'
```

## Response Format
```json
{
  "status": "success",
  "message": "AI GitOps pipeline initiated successfully",
  "data": {
    "tfs_number": "TFS123456",
    "branch_name": "feat/TFS123456-create-vlan-200",
    "merge_request_url": "https://gitlab.com/project/-/merge_requests/123",
    "servicenow_cr_id": "CHG0000123",
    "action_type": "create",
    "resource_type": "vlan",
    "urgency": "medium",
    "customer_id": "acme-corp",
    "next_steps": [
      "Await network team review of merge request",
      "Security scan will run automatically", 
      "CAB approval required for production deployment",
      "Staging tests will be executed upon approval"
    ]
  },
  "timestamp": "2024-08-11T10:30:00.000Z"
}
```

## Prerequisites

### Required Credentials
1. **OpenAI API Key** - For AI intent processing and playbook generation
2. **NetBox API Token** - Read access to network data
3. **GitLab/GitHub Token** - Repository write access for GitOps
4. **ServiceNow Credentials** - Change management integration
5. **Slack API Token** - Team notifications
6. **SMTP Credentials** - Email notifications

### Required Services
- n8n instance (>= v1.0)
- NetBox deployment with API access
- Git repository (GitLab/GitHub/Bitbucket)
- ServiceNow instance (optional)
- OpenAI/Claude API access
- Slack workspace (optional)

## Installation Steps

1. **Import Template**
   ```bash
   # Copy template to n8n workflows directory
   cp ai-gitops-network-automation-template.json /path/to/n8n/workflows/
   ```

2. **Configure Environment**
   ```bash
   # Copy and customize environment file
   cp ai-gitops-environment.env .env
   # Edit with your customer-specific values
   ```

3. **Set up Credentials**
   - Add OpenAI API credentials in n8n
   - Configure Git repository access
   - Set up notification channels

4. **Test Deployment**
   ```bash
   # Test with sample request
   curl -X POST https://your-n8n.com/webhook/ai-gitops-automation \
     -H "Content-Type: application/json" \
     -d '{"user_request": "Test VLAN creation", "urgency": "low"}'
   ```

## Customization

### AI Prompts
Modify the OpenAI prompts in nodes:
- **AI Intent Parser**: Adjust parsing logic for your use cases
- **AI Playbook Generator**: Customize Ansible templates

### Approval Workflows
Configure approval routing:
- Add/remove reviewers
- Modify approval criteria
- Integrate with existing ITSM tools

### Notification Channels
Extend notifications:
- Microsoft Teams
- PagerDuty
- Custom webhooks
- Dashboard updates

## Security Features

### Input Validation
- Sanitized user inputs
- Parameter validation
- SQL injection protection
- Command injection prevention

### Access Control
- Role-based permissions
- API key authentication
- Customer data isolation
- Audit trail logging

### Compliance
- SOX compliance ready
- PCI-DSS compatible
- GDPR data protection
- Change tracking

## Monitoring & Troubleshooting

### Built-in Logging
- Full execution traces
- Error handling and recovery
- Performance metrics
- User activity tracking

### Health Checks
- NetBox connectivity
- Git repository access
- AI service availability
- Notification delivery

### Common Issues
1. **NetBox Connection**: Check token and URL
2. **Git Authentication**: Verify repository permissions
3. **AI Service Limits**: Monitor OpenAI usage
4. **Approval Delays**: Check reviewer availability

## Enterprise Features

### High Availability
- Multi-instance deployment
- Database replication
- Failover mechanisms
- Load balancing

### Scaling
- Horizontal scaling support
- Queue management
- Resource optimization
- Performance tuning

### Integration
- REST API endpoints
- Webhook subscriptions
- SSO authentication
- Enterprise directories

---

**Template Version:** 2.0  
**Last Updated:** 2024-08-11  
**Compatibility:** n8n >= 1.0, NetBox >= 3.0  
**Support:** Enterprise support available
